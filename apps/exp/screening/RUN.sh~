#!/bin/bash

# -Dio.file.buffer.size=3145728

#for x in 100 500 1000 2000 5000 10000 
for x in 100 500 1000 2000 5000 10000 20000
 do for k in 20  
   do for r in 1 2 3
     do echo "datasize=$x, k=$k, r=$r"
     size=`ls -l ~/global/cloud/HiSeq_${x}M.fas | awk '{print \$5}'` 
     export PIG_OPTS='-Dmapred.job.name=datasize='$x',k='$k',r='$r' -Dio.file.buffer.size=1048576 -Dio.sort.record.percent=.33 -Dmapred.child.java.opts=-Xmx1G -Dio.sort.factor=1600 -Dio.sort.mb=250 -Dfs.inmemory.size.mb=250 -Dmapred.compress.map.output=true -Dmapred.max.split.size='$(($size/1600)) 
     time ( ~/pig/bin/pig -param k=$k -param reads=/users/kbhatia/cloud/HiSeq_${x}M.fas -param p=1600 -param outputdir=/users/kbhatia/cloud/big-$x.$k.$r pigscripts/kmerStats.pig >& ./big/HiSeq_${x}M.${k}.${r}.log )  
   done
 done 
done

